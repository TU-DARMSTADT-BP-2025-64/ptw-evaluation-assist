{"version":3,"file":"_server.ts-DYGSn6Yz.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/product/_id_/_server.ts.js"],"sourcesContent":["import { R as Repository } from \"../../../../../chunks/repository.js\";\nasync function DELETE({ params }) {\n  console.log(\"DeleteProduct\", params);\n  const repository = Repository.Instance;\n  const result = repository.deleteProduct(params.id);\n  return new Response(JSON.stringify(result));\n}\nasync function GET({ params, url }) {\n  console.log(\"GetProduct\", params);\n  const repository = Repository.Instance;\n  const result = repository.getProduct(params.id);\n  if (!result) {\n    return new Response(null, { status: 404 });\n  }\n  const asTreeView = url.searchParams.get(\"asTreeView\") === \"true\";\n  if (asTreeView) {\n    const treeViewElements = getAllTreeViewElements(repository, result);\n    return new Response(JSON.stringify(treeViewElements));\n  } else {\n    return new Response(JSON.stringify(result));\n  }\n}\nasync function PUT({ params, request, url }) {\n  const repository = Repository.Instance;\n  const asTreeView = url.searchParams.get(\"asTreeView\") === \"true\";\n  if (asTreeView) {\n    const existingProduct = repository.getProduct(params.id);\n    if (existingProduct) {\n      repository.deleteProduct(params.id);\n    }\n    const productElements = await request.json();\n    if (!existingProduct) {\n      productElements.product.createdAt = Date.now();\n    }\n    const newProduct = repository.addProduct(productElements.product);\n    const resultElements = {\n      product: newProduct,\n      groups: [],\n      components: [],\n      wearCriteria: [],\n      wearThresholds: [],\n      strategies: []\n    };\n    for (const group of productElements.groups) {\n      resultElements.groups.push(repository.addAssemblyGroup(group));\n    }\n    for (const component of productElements.components) {\n      resultElements.components.push(repository.addAssemblyComponent(component));\n    }\n    for (const criterion of productElements.wearCriteria) {\n      resultElements.wearCriteria.push(repository.addWearCriterion(criterion));\n    }\n    for (const threshold of productElements.wearThresholds) {\n      resultElements.wearThresholds.push(repository.addWearThreshold(threshold));\n    }\n    for (const strategy of productElements.strategies) {\n      resultElements.strategies.push(repository.addThresholdStrategy(strategy));\n    }\n    return new Response(JSON.stringify(resultElements));\n  } else {\n    const product = await request.json();\n    const result = repository.addProduct(product);\n    return new Response(JSON.stringify(result));\n  }\n}\nfunction getAllTreeViewElements(repository, product) {\n  const groups = repository.getAssemblyGroups(product.id);\n  const components = repository.getAssemblyComponents(product.id);\n  const wearCriteria = repository.getWearCriteria(product.id);\n  const wearThresholds = repository.getWearThresholds(product.id);\n  const strategies = repository.getThresholdStrategies(product.id);\n  return {\n    product,\n    groups,\n    components,\n    wearCriteria,\n    wearThresholds,\n    strategies\n  };\n}\nexport {\n  DELETE,\n  GET,\n  PUT\n};\n"],"names":[],"mappings":"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"}