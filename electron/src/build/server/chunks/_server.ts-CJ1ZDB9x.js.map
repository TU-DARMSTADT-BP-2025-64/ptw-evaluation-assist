{"version":3,"file":"_server.ts-CJ1ZDB9x.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/change-password/_server.ts.js"],"sourcesContent":["import { j as json } from \"../../../../chunks/index2.js\";\nimport bcrypt from \"bcrypt\";\nimport { D as DatabaseClient, S as ServerConstants } from \"../../../../chunks/server-constants.js\";\nasync function POST({ request }) {\n  try {\n    const { currentPassword, newPassword } = await request.json();\n    if (!currentPassword || !newPassword) {\n      return json({ message: \"Alle Felder müssen ausgefüllt werden.\" }, { status: 400 });\n    }\n    const db = new DatabaseClient(ServerConstants.DATABASE_NAME).getDatabase();\n    const statement = db.prepare(\"SELECT * FROM users WHERE username = ?\");\n    const adminUser = statement.get(\"admin\");\n    if (!adminUser) {\n      return json({ message: \"Admin-Benutzer nicht gefunden.\" }, { status: 404 });\n    }\n    const passwordMatches = await bcrypt.compare(currentPassword, adminUser.password);\n    if (!passwordMatches) {\n      return json({ message: \"Das aktuelle Passwort ist falsch.\" }, { status: 400 });\n    }\n    const hashedPassword = await bcrypt.hash(newPassword, 10);\n    const updateStatement = db.prepare(\"UPDATE users SET password = ? WHERE username = ?\");\n    const result = updateStatement.run(hashedPassword, \"admin\");\n    if (result.changes === 1) {\n      return json({ message: \"Passwort erfolgreich geändert.\" });\n    } else {\n      return json({ message: \"Fehler beim Aktualisieren des Passworts.\" }, { status: 500 });\n    }\n  } catch (error) {\n    console.error(\"Fehler beim Ändern des Passworts:\", error);\n    return json({ message: \"Interner Serverfehler.\" }, { status: 500 });\n  }\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":";;;;;;;;;;AAGA,eAAe,IAAI,CAAC,EAAE,OAAO,EAAE,EAAE;AACjC,EAAE,IAAI;AACN,IAAI,MAAM,EAAE,eAAe,EAAE,WAAW,EAAE,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE;AACjE,IAAI,IAAI,CAAC,eAAe,IAAI,CAAC,WAAW,EAAE;AAC1C,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,uCAAuC,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACxF;AACA,IAAI,MAAM,EAAE,GAAG,IAAI,cAAc,CAAC,eAAe,CAAC,aAAa,CAAC,CAAC,WAAW,EAAE;AAC9E,IAAI,MAAM,SAAS,GAAG,EAAE,CAAC,OAAO,CAAC,wCAAwC,CAAC;AAC1E,IAAI,MAAM,SAAS,GAAG,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC;AAC5C,IAAI,IAAI,CAAC,SAAS,EAAE;AACpB,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,gCAAgC,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACjF;AACA,IAAI,MAAM,eAAe,GAAG,MAAM,MAAM,CAAC,OAAO,CAAC,eAAe,EAAE,SAAS,CAAC,QAAQ,CAAC;AACrF,IAAI,IAAI,CAAC,eAAe,EAAE;AAC1B,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,mCAAmC,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACpF;AACA,IAAI,MAAM,cAAc,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,CAAC;AAC7D,IAAI,MAAM,eAAe,GAAG,EAAE,CAAC,OAAO,CAAC,kDAAkD,CAAC;AAC1F,IAAI,MAAM,MAAM,GAAG,eAAe,CAAC,GAAG,CAAC,cAAc,EAAE,OAAO,CAAC;AAC/D,IAAI,IAAI,MAAM,CAAC,OAAO,KAAK,CAAC,EAAE;AAC9B,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,gCAAgC,EAAE,CAAC;AAChE,KAAK,MAAM;AACX,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,0CAA0C,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC3F;AACA,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,mCAAmC,EAAE,KAAK,CAAC;AAC7D,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,wBAAwB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACvE;AACA;;;;"}